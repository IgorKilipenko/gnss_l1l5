cmake_minimum_required(VERSION 3.10)
set(PROJECT_NAME "serialport")
project(${PROJECT_NAME} LANGUAGES C)

set(SOURCE_PATH "../../third_party/libserialport")
set(OUT_LIB_PATH "../../third_party/out/lib${PROJECT_NAME}")
#set(CMAKE_BINARY_DIR ${CMAKE_CURRENT_SOURCE_DIR})
#set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/debug) 

add_library(${PROJECT_NAME} SHARED
  "${SOURCE_PATH}/serialport.c"
  "${SOURCE_PATH}/timing.c"
  "${SOURCE_PATH}/windows.c"
)

#target_compile_options(${PROJECT_NAME} PRIVATE
#  -std=c99 -Wall -Wextra -pedantic -Wmissing-prototypes -Wshadow)
target_compile_definitions(${PROJECT_NAME} PRIVATE LIBSERIALPORT_MSBUILD)
target_include_directories(${PROJECT_NAME} PRIVATE
  #"${CMAKE_CURRENT_SOURCE_DIR}"
  "${CMAKE_CURRENT_SOURCE_DIR}/${SOURCE_PATH}")
target_link_libraries(${PROJECT_NAME} PRIVATE cfgmgr32 SetupAPI)
set_target_properties(
  ${PROJECT_NAME}
  PROPERTIES
  PREFIX ""
  OUTPUT_NAME ${PROJECT_NAME}
  RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/${OUT_LIB_PATH}
  )